# Bricky - LEGO Store Project Copilot Instructions

## Project Overview

**Bricky** is a modern Django-based e-commerce platform specialized in LEGO products. The project uses Django 5.2.7+ with a custom user model and comprehensive product management system.

- **Framework**: Django 5.2.7+
- **Package Manager**: Poetry
- **Python Version**: 3.12+
- **Database**: SQLite (development)
- **Key Libraries**: 
  - django-phonenumber-field
  - django-debug-toolbar
  - Pillow (image processing)
  - environs (environment variables)

---

## Project Structure

```
Bricky/
├── bricky/                 # Main Django configuration
│   ├── settings.py        # Global settings (uses environs for .env)
│   ├── urls.py            # Root URL routing with all apps connected
│   ├── wsgi.py
│   └── asgi.py
│
├── users/                 # User authentication & profiles
│   ├── models.py          # CustomUser (extends AbstractUser)
│   ├── views.py           # LoginView, RegisterView, ProfileView, EmailVerifyView
│   ├── forms.py           # UserLoginForm, UserRegisterForm
│   ├── urls.py            # auth routes with 'users:' namespace
│   └── templates/users/
│       ├── auth/          # login.html, register.html
│       ├── email/         # verification & confirmation emails
│       └── profile/       # dashboard.html, edit.html
│
├── core/                  # Legal pages, contact, newsletter
│   ├── models.py          # ContactMessage, NewsletterSubscription, HelpCategory, HelpArticle, Review
│   ├── views.py           # PrivacyPolicyView, ContactView, NewsletterSubscribeView
│   ├── forms.py           # ContactForm, NewsletterSubscriptionForm, ReviewForm
│   ├── urls.py            # routes with 'core:' namespace
│   ├── templatetags/      # Custom template filters (mul, div)
│   └── templates/core/
│       ├── base.html      # Main layout with navigation
│       ├── index.html     # Homepage (actually in core template but IndexView is in store)
│       ├── legal/         # privacy.html, terms.html
│       ├── pages/         # about.html, contact.html
│       └── newsletter/    # subscribe.html, success.html
│
├── store/                 # Product catalog & browsing
│   ├── models.py          # Category, Product, Cart, CartItem, Review
│   ├── views.py           # IndexView, CategoryView, ShopView, ProductDetailView, SearchView
│   ├── forms.py           # Search, filter forms
│   ├── urls.py            # product routes with 'store:' namespace
│   └── templates/store/
│       ├── product/       # product_detail.html, category.html
│       └── shop/          # shop.html, search.html, new_releases.html
│
├── orders/                # Shopping cart & checkout
│   ├── models.py          # Customer, Order, OrderElement, Delivery
│   ├── views.py           # CartView, CheckoutView, PlaceOrderView
│   ├── forms.py           # Checkout forms
│   ├── urls.py            # cart/order routes with 'orders:' namespace
│   └── templates/orders/cart/
│       ├── cart.html
│       ├── checkout.html
│       └── order_confirmation.html
│
├── notifications/         # Notification system (placeholder)
│   ├── models.py
│   ├── views.py
│   └── urls.py
│
├── static/               # Frontend assets (development)
│   ├── core/css/
│   ├── store/css/
│   ├── store/js/
│   └── users/
│
├── media/                # User uploads (product images, profile pictures)
│   ├── categories/
│   ├── products/
│   └── user_pictures/
│
├── db.sqlite3           # Development database
├── pyproject.toml       # Poetry configuration & dependencies
├── manage.py            # Django management command
└── .env                 # Environment variables (not in git)
```

---

## Database Models

### users.CustomUser
- **Purpose**: Extended Django User with email verification, phone, profile picture
- **Key Fields**: email (unique), email_is_verified, phone (PhoneNumberField), picture
- **Key Methods**: Standard User methods inherited
- **Used by**: All authentication flows, reviews, orders

### store.Product
- **Purpose**: Product catalog entries
- **Key Fields**: name, slug (unique), price, stock, category (FK), status (NEW/OLD/COMING_SOON)
- **Key Methods**: `get_absolute_url()` - returns `store:product_detail` reverse URL
- **Related**: reviews, order_elements, cart_items
- **Indexes**: slug, name, category, is_active

### store.Category
- **Purpose**: Product categorization
- **Key Fields**: title, slug (unique), picture
- **Related**: products (reverse)

### store.Cart & CartItem
- **Purpose**: Shopping cart management
- **Cart**: OneToOne with CustomUser
- **CartItem**: ForeignKey to Product
- **Key Methods**: get_total_price(), get_total_items()

### orders.Order & OrderElement
- **Purpose**: Order processing
- **Order**: status (NEW/PROCESSED/SHIPPED/COMPLETED), customer (FK), total_price
- **OrderElement**: product (FK), price, quantity
- **Key Methods**: calculate_total()

### core.ContactMessage
- **Purpose**: Contact form submissions
- **Status**: NEW → READING → REPLIED → CLOSED
- **Subjects**: GENERAL, ORDER, SHIPPING, RETURN, PARTNERSHIP, OTHER

### core.NewsletterSubscription
- **Purpose**: Email newsletter management
- **Status**: ACTIVE or UNSUBSCRIBED

### core.Review
- **Purpose**: Product reviews by users
- **Key Fields**: rating (1-5), is_approved, helpful_count
- **Constraint**: unique_together [product, author] - one review per user per product

### core.HelpCategory & HelpArticle
- **Purpose**: FAQ/Help system
- **HelpArticle**: ForeignKey to HelpCategory with helpful voting

---

## URL Namespaces & Routing

All apps use Django URL namespacing to avoid conflicts:

### Core Namespace ('core:')
- `contact` → ContactView
- `about` → AboutView
- `privacy_policy` → PrivacyPolicyView
- `terms_of_service` → TermsOfServiceView
- `newsletter_subscribe` → NewsletterSubscribeView (form-based)
- `newsletter_subscribe_ajax` → NewsletterSubscribeAjaxView (AJAX)
- `newsletter_success` → NewsletterSuccessView

### Store Namespace ('store:')
- `index` → IndexView (homepage)
- `shop` → ShopView (all products)
- `category/<slug:slug>/` → CategoryView
- `product/<slug:slug>/` → ProductDetailView
- `new_releases` → NewReleasesView
- `search` → SearchView
- `api/search/` → search_api (JSON endpoint)
- `api/autocomplete/` → search_autocomplete (JSON endpoint)
- `review/create/` → CreateReviewView
- `review/<int:review_id>/helpful/` → ReviewHelpfulView

### Users Namespace ('users:')
- `login` → LoginView
- `register` → RegisterView
- `profile` → ProfileView
- `profile/edit` → ProfileEditView
- `logout` → user_logout
- `verify-email/<uidb64>/<token>/` → EmailVerifyView
- `resend-verification-email` → ResendVerificationEmailView

### Orders Namespace ('orders:')
- `cart/` → CartView
- `cart/add/` → AddToCartView (POST)
- `cart/remove/` → RemoveFromCartView (POST)
- `cart/update/` → UpdateCartItemView (POST)
- `cart/clear/` → ClearCartView (POST)
- `checkout/` → CheckoutView
- `order/place/` → PlaceOrderView
- `order/<uuid:order_uuid>/confirmation/` → OrderConfirmationView

**Important**: All `core:index` references redirect to `store:index` (homepage is in store app)

---

## Key Templates

### Base Template (core/templates/core/base.html)
- Main layout with navigation, footer, search modal
- Extends: None (base template)
- Blocks: title, content, extra_css, extra_js
- Navigation links use correct namespaces: `store:` for products, `core:` for legal/contact

### Important Template Tags
- Custom filter `mul`: multiply values for price calculations
- Custom filter `div`: divide values
- Located in: core/templatetags/custom_filters.py

### Form Templates
- Newsletter forms exist in multiple locations (header, product detail, footer)
- AJAX endpoint: `core:newsletter_subscribe_ajax`
- Form-based endpoint: `core:newsletter_subscribe`

---

## Development Workflow with Poetry

### Environment Setup
```bash
# Install dependencies
poetry install

# Activate virtual environment
poetry shell

# Run migrations
python manage.py migrate

# Create superuser
python manage.py createsuperuser

# Start development server
python manage.py runserver
```

### Managing Dependencies
```bash
# Add new package
poetry add package_name

# Add dev dependency
poetry add --group dev package_name

# Update all dependencies
poetry update

# Export requirements.txt
poetry export -f requirements.txt --output requirements.txt
```

### Environment Variables (.env)
Create a `.env` file with:
```
DEBUG=True
SECRET_KEY=your-secret-key-here
DATABASE_URL=sqlite:///db.sqlite3
EMAIL_BACKEND=django.core.mail.backends.console.EmailBackend
EMAIL_HOST=smtp.gmail.com
EMAIL_HOST_USER=your-email@gmail.com
EMAIL_HOST_PASSWORD=your-app-password
DEFAULT_FROM_EMAIL=noreply@bricky.com
```

---

## Code Conventions

### Models
- Use UUID for primary keys across all models
- Always include `__str__` method for admin readability
- Use descriptive `verbose_name` and `verbose_name_plural` in Meta
- Define database indexes on frequently queried fields (slug, email, status)
- Use TextChoices for status/choice fields
- Include docstrings for all model classes

### Views
- Use class-based views (ListView, DetailView, TemplateView, CreateView)
- Use LoginRequiredMixin for protected views
- Include docstrings describing GET/POST behavior
- Return correct HTTP status codes
- Use reverse_lazy() for redirect URLs with namespace

### Templates
- Use `{% load static %}` at top of template
- Always use correct namespace in URL reversals: `{% url 'namespace:name' %}`
- Use Django template filters for number formatting: `|floatformat:2`
- Include CSRF token in all POST forms: `{% csrf_token %}`
- Use semantic HTML5 elements

### Forms
- Extend Django forms (ModelForm for model-based)
- Include custom clean methods for validation
- Define helpful_text for form fields
- Use CSS classes for styling: class="form-control"

### JavaScript/CSS
- Store static files in: static/[app_name]/css/ and static/[app_name]/js/
- Use data attributes for Django URL passing in templates
- Collect static files before deployment: `python manage.py collectstatic`

---

## Settings Configuration

### Key Settings
- **AUTH_USER_MODEL**: "users.CustomUser" (custom user model)
- **INSTALLED_APPS**: All 5 apps installed (users, core, store, orders, notifications)
- **SITE_ID**: 1 (Django sites framework)
- **TIMEZONE**: "Europe/Istanbul"
- **LANGUAGE_CODE**: "en" with Turkish support
- **DEFAULT_AUTO_FIELD**: "django.db.models.BigAutoField"

### Static Files
- **STATIC_URL**: /static/
- **STATIC_ROOT**: Base_DIR / 'staticfiles'
- **STATICFILES_DIRS**: [Base_DIR / 'static']
- **MEDIA_URL**: /media/
- **MEDIA_ROOT**: Base_DIR / 'media'

### Debug Toolbar
- Enabled in development (DEBUG=True)
- INTERNAL_IPS = ["127.0.0.1"]
- Middleware: debug_toolbar.middleware.DebugToolbarMiddleware

---

## Common Tasks

### Adding a New Model
1. Create model in app/models.py with UUID primary key
2. Add docstring and __str__ method
3. Define Meta class with verbose_name, ordering, indexes
4. Create migration: `python manage.py makemigrations app_name`
5. Apply migration: `python manage.py migrate`
6. Register in app/admin.py if needed

### Adding a New View
1. Create class-based view in app/views.py
2. Add docstring describing GET/POST behavior
3. Add URL pattern in app/urls.py with app_name namespace
4. Create template in app/templates/app_name/
5. Use correct URL namespace in template: `{% url 'app_name:view_name' %}`

### Adding a New Form
1. Create form in app/forms.py (ModelForm or Form)
2. Define fields and widgets
3. Add custom clean methods for validation
4. Import in views.py and use in views
5. Create template with `{% csrf_token %}`

### Debugging
- Use Django Debug Toolbar: /?__debug__=True
- Check console emails in development (EmailBackend = console)
- Use `print()` for quick debugging
- Check Django logs in terminal output

---

## Important Notes

### Email Configuration
- **Development**: Uses console backend (prints to terminal)
- **Production**: Configure SMTP (Gmail, SendGrid, etc.)
- Email verification flow uses Django's token_generator
- Password reset uses built-in Django functionality

### Authentication
- Custom user model: CustomUser (inherits AbstractUser)
- Email verification required before full access
- Token-based email verification (24-hour tokens)
- Phone number optional with phonenumber_field

### Product Management
- Products have 3 statuses: NEW, OLD, COMING_SOON
- Stock tracking per product
- Image uploads to media/products/
- Slug field for SEO-friendly URLs

### Order Processing
- Orders track through states: NEW → PROCESSED → SHIPPED → COMPLETED
- Draft orders for in-progress transactions
- Separate Customer model for additional delivery info
- Order items maintain historical price (not linked to Product.price)

### Static Files
- Static files in development served from static/ directly
- Run `collectstatic` before production
- Images processed with Pillow (supports JPEG, PNG, etc.)

---

## Testing

### Running Tests
```bash
poetry run python manage.py test

# Test specific app
poetry run python manage.py test users

# Test with verbose output
poetry run python manage.py test -v 2
```

### Code Quality
- **Linter**: Ruff is configured in pyproject.toml
- **Ignored Rules**: F401 (unused imports), F841 (unused variables)
- Run: `poetry run ruff check .`
- Fix: `poetry run ruff check --fix .`

---

## Deployment Checklist

- [ ] Set DEBUG=False in .env
- [ ] Set SECRET_KEY to secure random value
- [ ] Configure ALLOWED_HOSTS
- [ ] Set EMAIL_BACKEND to SMTP
- [ ] Configure database (PostgreSQL recommended)
- [ ] Run migrations: `python manage.py migrate`
- [ ] Collect static files: `python manage.py collectstatic`
- [ ] Set up SSL/HTTPS
- [ ] Configure CSRF_TRUSTED_ORIGINS
- [ ] Set up proper logging
- [ ] Use production WSGI server (Gunicorn, uWSGI)

---

## Useful Django Commands

```bash
# Create new app
poetry run python manage.py startapp app_name

# Create migrations
poetry run python manage.py makemigrations

# Apply migrations
poetry run python manage.py migrate

# Create admin user
poetry run python manage.py createsuperuser

# Shell (interactive Python with Django context)
poetry run python manage.py shell

# Check for issues
poetry run python manage.py check

# Run development server
poetry run python manage.py runserver 0.0.0.0:8000

# Collect static files
poetry run python manage.py collectstatic

# Export data
poetry run python manage.py dumpdata > data.json

# Load data
poetry run python manage.py loaddata data.json
```

---

## External Dependencies

### Core Django Packages
- django-phonenumber-field: Phone number validation and storage
- django-debug-toolbar: Development debugging interface
- Pillow: Image processing for product/user pictures
- environs: Environment variable management

### Frontend Assets Included
- Font Awesome 6.5.1 (CSS icons)
- Custom CSS for Bricky branding
- Custom JavaScript for product interactions and cart

---

## Contact & Support

- **Project Lead**: kerem212012 (rockstarfoxykerem@gmail.com)
- **Repository**: Bricky LEGO Store
- **Current Version**: 0.1.0
- **Django Version**: 5.2.7+

---

## Quick Reference: URL Namespace Rules

| App | Namespace | Purpose | Example |
|-----|-----------|---------|---------|
| core | `core:` | Legal, contact, newsletter | `{% url 'core:contact' %}` |
| store | `store:` | Products, search, reviews | `{% url 'store:product_detail' slug=product.slug %}` |
| users | `users:` | Auth, profile, verification | `{% url 'users:login' %}` |
| orders | `orders:` | Cart, checkout, orders | `{% url 'orders:cart' %}` |

**Critical**: Don't use `core:` for product/home URLs - they are in `store:` namespace!

---

*Last Updated: December 25, 2025*
*Version: 1.0 - Initial Comprehensive Instructions*
